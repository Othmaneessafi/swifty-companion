{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport axios from 'axios';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default function Index(_ref) {\n  var navigation = _ref.navigation;\n\n  var _React$useState = React.useState(\"\"),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      login = _React$useState2[0],\n      onChangeLogin = _React$useState2[1];\n\n  var getToken = function getToken() {\n    var response;\n    return _regeneratorRuntime.async(function getToken$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(axios.post(\"https://api.intra.42.fr/oauth/token\", {\n              grant_type: \"client_credentials\",\n              client_id: \"185fe61bbde778abe84872211f868a11b5cba96e6b460c69c48c7bca64f85dff\",\n              client_secret: \"67818d94253e168245c7be72599af92a97f4e7dc22543e2104f67fa661857146\"\n            }));\n\n          case 3:\n            response = _context.sent;\n\n            if (!response.data) {\n              _context.next = 11;\n              break;\n            }\n\n            console.log(response.data);\n            _context.next = 8;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"access_token\", JSON.stringify(response.data)));\n\n          case 8:\n            return _context.abrupt(\"return\", response.data);\n\n          case 11:\n            console.log(\"error\");\n\n          case 12:\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"catch\");\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 14]], Promise);\n  };\n\n  var getUser = function getUser(login) {\n    var token, response;\n    return _regeneratorRuntime.async(function getUser$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"access_token\"));\n\n          case 3:\n            token = _context2.sent;\n\n            if (!token) {\n              _context2.next = 13;\n              break;\n            }\n\n            token = JSON.parse(token);\n\n            if (!(token.created_at + token.expires_in <= Date.now() / 1000)) {\n              _context2.next = 11;\n              break;\n            }\n\n            console.log(\"token expired\");\n            _context2.next = 10;\n            return _regeneratorRuntime.awrap(getToken());\n\n          case 10:\n            token = _context2.sent;\n\n          case 11:\n            _context2.next = 16;\n            break;\n\n          case 13:\n            _context2.next = 15;\n            return _regeneratorRuntime.awrap(getToken());\n\n          case 15:\n            token = _context2.sent;\n\n          case 16:\n            _context2.next = 18;\n            return _regeneratorRuntime.awrap(axios.get(\"https://api.intra.42.fr/v2/users/\" + login.trim().toLowerCase(), {\n              headers: {\n                Authorization: \"Bearer \" + token.access_token\n              }\n            }));\n\n          case 18:\n            response = _context2.sent;\n\n            if (response.data) {\n              console.log(response.data);\n              navigation.navigate('Infos', {\n                userData: response.data\n              });\n            } else {\n              console.log(\"error\");\n            }\n\n            _context2.next = 25;\n            break;\n\n          case 22:\n            _context2.prev = 22;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(_context2.t0);\n\n          case 25:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 22]], Promise);\n  };\n\n  var auth = function auth(login) {\n    var response;\n    return _regeneratorRuntime.async(function auth$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(axios.get(\"https://api.intra.42.fr/oauth/authorize?client_id=185fe61bbde778abe84872211f868a11b5cba96e6b460c69c48c7bca64f85dff&redirect_uri=http%3A%2F%2Flocalhost%3A19006%2F&response_type=code\", {\n              headers: {\n                Authorization: \"Bearer \" + token.access_token\n              }\n            }));\n\n          case 3:\n            response = _context3.sent;\n\n            if (response) {\n              console.log(response);\n            } else {\n              console.log(\"error\");\n            }\n\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(_context3.t0);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var styles = StyleSheet.create({\n    container: {\n      flex: 1\n    },\n    button: {\n      backgroundColor: 'transparent',\n      width: 100,\n      textAlign: 'center',\n      borderRadius: 10,\n      padding: 10,\n      borderWidth: 1,\n      borderColor: \"whitesmoke\"\n    },\n    input: {\n      height: 40,\n      margin: 12,\n      borderWidth: 1,\n      padding: 10,\n      borderRadius: 5,\n      borderColor: \"whitesmoke\",\n      color: \"whitesmoke\",\n      width: 200\n    },\n    image: {\n      flex: 1,\n      justifyContent: \"center\",\n      alignItems: 'center'\n    },\n    logo: {\n      color: \"whitesmoke\",\n      fontSize: 40\n    },\n    title: {\n      color: \"whitesmoke\",\n      fontSize: 18\n    },\n    text: {\n      color: \"whitesmoke\"\n    }\n  });\n  var image = {\n    uri: \"https://42.fr/wp-content/uploads/2021/06/Rectangle-3-1024x774.png\"\n  };\n  return _jsxs(_Fragment, {\n    children: [auth(), _jsx(View, {\n      style: styles.container,\n      children: _jsxs(ImageBackground, {\n        source: image,\n        resizeMode: \"cover\",\n        style: styles.image,\n        children: [_jsx(Text, {\n          style: styles.logo,\n          children: \"Swifty-companion\"\n        }), _jsx(Text, {\n          style: styles.title,\n          children: \"Search for login\"\n        }), _jsx(TextInput, {\n          style: styles.input,\n          onChangeText: onChangeLogin,\n          value: login,\n          placeholder: \"Enter login\"\n        }), _jsx(Pressable, {\n          style: styles.button,\n          title: \"Search\",\n          onPress: function onPress() {\n            return getUser(login);\n          },\n          children: _jsx(Text, {\n            style: styles.text,\n            children: \"Search\"\n          })\n        })]\n      })\n    })]\n  });\n}","map":{"version":3,"sources":["/goinfre/oes-safi/swifty-companion/components/Home/index.js"],"names":["React","AsyncStorage","axios","Index","navigation","useState","login","onChangeLogin","getToken","post","grant_type","client_id","client_secret","response","data","console","log","setItem","JSON","stringify","getUser","getItem","token","parse","created_at","expires_in","Date","now","get","trim","toLowerCase","headers","Authorization","access_token","navigate","userData","auth","styles","StyleSheet","create","container","flex","button","backgroundColor","width","textAlign","borderRadius","padding","borderWidth","borderColor","input","height","margin","color","image","justifyContent","alignItems","logo","fontSize","title","text","uri"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { StyleSheet, Text, ImageBackground, View, Button, Pressable, TextInput} from 'react-native';\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport axios from 'axios';\n\nexport default function Index({ navigation }) {\n    const [login, onChangeLogin] = React.useState(\"\");\n\n    const getToken = async () => {\n      try {\n        const response = await axios.post(`https://api.intra.42.fr/oauth/token`,\n          {\n            grant_type: \"client_credentials\",\n            client_id: \"185fe61bbde778abe84872211f868a11b5cba96e6b460c69c48c7bca64f85dff\",\n            client_secret: \"67818d94253e168245c7be72599af92a97f4e7dc22543e2104f67fa661857146\",\n          }\n        )\n        if (response.data) {\n          console.log(response.data);\n          await AsyncStorage.setItem(\"access_token\", JSON.stringify(response.data));\n          return(response.data)\n        }\n        else {\n          console.log(\"error\");\n        }\n      } catch (error) {\n        console.log(\"catch\");\n      }\n    }\n    \n\n    const getUser = async (login) => {\n    \n      try {\n        var token = await AsyncStorage.getItem(\"access_token\");\n        if (token){\n          token = JSON.parse(token);\n          if ((token.created_at + token.expires_in) <= (Date.now() / 1000)) {\n              console.log(\"token expired\");\n              token = await getToken();\n          }\n        } else token = await getToken();\n        const response = await axios.get(`https://api.intra.42.fr/v2/users/${login.trim().toLowerCase()}`,\n          {\n            headers: {\n              Authorization: `Bearer ${token.access_token}`\n            }\n          } \n        );\n        if (response.data) {\n          console.log(response.data)\n          navigation.navigate('Infos', {userData: response.data})\n        }\n        else {\n          console.log(\"error\");\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    \n    }\n    const auth = async (login) => {\n    \n      try {\n        const response = await axios.get(`https://api.intra.42.fr/oauth/authorize?client_id=185fe61bbde778abe84872211f868a11b5cba96e6b460c69c48c7bca64f85dff&redirect_uri=http%3A%2F%2Flocalhost%3A19006%2F&response_type=code`,\n          {\n            headers: {\n              Authorization: `Bearer ${token.access_token}`\n            }\n          } \n        );\n        if (response) {\n          console.log(response)\n        }\n        else {\n          console.log(\"error\");\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    \n    }\n\n    const styles = StyleSheet.create({\n        container: {\n          flex: 1,\n          // backgroundColor: '#fff',\n          // alignItems: 'center',\n          // justifyContent: 'center',\n        },\n        button: {\n          backgroundColor: 'transparent',\n          width: 100,\n          textAlign: 'center',\n          borderRadius: 10,\n          padding: 10,\n          // border: '1px solid whitesmoke',\n          borderWidth: 1,\n          borderColor: \"whitesmoke\",\n        },\n        input: {\n          height: 40,\n          margin: 12,\n          borderWidth: 1,\n          padding: 10,\n          borderRadius: 5,\n          borderColor: \"whitesmoke\",\n          color: \"whitesmoke\",\n          width: 200,\n        },\n        image : {\n          flex: 1,\n          justifyContent: \"center\",\n          alignItems: 'center',\n        },\n        logo : {\n          color: \"whitesmoke\",\n          fontSize: 40,\n        },\n        title : {\n          color: \"whitesmoke\",\n          fontSize: 18,\n        },\n        text : {\n          color: \"whitesmoke\",\n        },\n      });\n\n      const image = { uri: \"https://42.fr/wp-content/uploads/2021/06/Rectangle-3-1024x774.png\" };\n      return (\n        <>\n        {auth()}\n        <View style={styles.container}>\n        <ImageBackground source={image} resizeMode=\"cover\" style={styles.image}>\n          <Text style={styles.logo} >Swifty-companion</Text>\n          <Text style={styles.title} >Search for login</Text>\n          <TextInput\n            style={styles.input}\n            onChangeText={onChangeLogin}\n            value={login}\n            placeholder=\"Enter login\"\n          />\n          <Pressable style={styles.button} title=\"Search\" onPress={() => getUser(login)}><Text style={styles.text}>Search</Text></Pressable>\n          </ImageBackground>\n        </View>\n        </>\n      )\n}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}